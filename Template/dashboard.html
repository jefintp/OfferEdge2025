{% extends 'base_logged_in.html' %}
{% load custom_tags %}
{% block title %}Welcome | OfferEdge{% endblock %}

{% block content %}
<main class="flex items-center justify-center min-h-screen px-4 bg-gray-50">
  <div class="bg-white shadow-xl rounded-xl p-8 w-full max-w-2xl text-center">
    
    <!-- 🔔 Custom Dashboard Greeting -->
    <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome to Offeredge Dashboard</h1>
    <p class="text-lg text-gray-600 mb-6">Hello, {{ userid }}!</p>

    <p class="text-gray-600 mb-6">What would you like to do today?</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">
      <a href="/requirements/post" class="block bg-blue-600 text-white py-4 rounded-lg hover:bg-blue-700 transition">
        <span class="text-lg font-semibold">📌 Post a Requirement</span>
        <p class="text-sm mt-1">Describe what you need and let sellers bid.</p>
      </a>

      <a href="/quotes/explore" class="block bg-green-600 text-white py-4 rounded-lg hover:bg-green-700 transition">
        <span class="text-lg font-semibold">💬 Place a Bid</span>
        <p class="text-sm mt-1">Explore buyer requests and make your offer.</p>
      </a>
    </div>

   <!-- 📋 Your Posted Requirements -->
<div class="text-left mb-10">
  <h2 class="text-xl font-semibold text-gray-700 mb-4">Your Posted Requirements</h2>
  {% if requirements %}
    <ul class="space-y-4">
      {% for req in requirements %}
        <li class="bg-gray-100 p-4 rounded-lg shadow-sm">
          <h3 class="text-lg font-bold text-blue-600">
            <a href="/quotes/for/{{ req.id }}" class="hover:underline">
              {{ req.title }}
            </a>
          </h3>
          <p class="text-sm text-gray-700">{{ req.description }}</p>
          <p class="text-sm">Quantity: {{ req.quantity }}</p>
          <p class="text-sm">Expected Price: {{ req.expectedPriceRange }}</p>
          <p class="text-sm">Deadline: {{ req.deadline }}</p>
          <p class="text-xs text-gray-400">Posted at: {{ req.createdAt }}</p>

          <p class="text-xs text-gray-500">Quotes received: {{ req.quotes|length }}</p>

          {% for quote in req.quotes %}
            <div class="mt-2 p-2 border rounded bg-gray-50">
              <p class="text-sm">💰 Price: ₹{{ quote.price }}</p>
              <p class="text-sm">🚚 Delivery: {{ quote.deliveryTimeline }}</p>
              <p class="text-sm">📝 Notes: {{ quote.notes }}</p>
              <p class="text-xs text-gray-500">Chat eligible: {{ req.chat_flags|get_item:quote.id }}</p>

              {% if req.chat_flags|get_item:quote.id %}
                <a href="/chat/{{ quote.id }}" class="text-blue-600 hover:underline text-sm block mt-2">
                  💬 Start Negotiation
                </a>
              {% endif %}
            </div>
          {% empty %}
            <p class="text-sm text-red-500">No quotes yet.</p>
          {% endfor %}
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-gray-600">You haven’t posted any requirements yet.</p>
  {% endif %}
</div>
    <!-- 📄 Your Placed Quotes -->
    <div class="text-left mb-10">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">Your Placed Quotes</h2>
      {% if my_quotes %}
        <ul class="space-y-4">
          {% for quote in my_quotes %}
            <li class="bg-gray-100 p-4 rounded-lg shadow-sm">
              <h3 class="text-lg font-bold text-green-600">
                {{ req_map|get_item:quote.req_id }}
              </h3>
              <p class="text-sm">💰 Price: ₹{{ quote.price }}</p>
              <p class="text-sm">📦 Delivery Timeline: {{ quote.deliveryTimeline }}</p>
              <p class="text-sm">📝 Notes: {{ quote.notes }}</p>
              <p class="text-xs text-gray-400">Placed at: {{ quote.createdon }}</p>

              <p class="text-xs text-gray-500">Chat eligible: {{ chat_enabled_map|get_item:quote.id }}</p>

              {% if chat_enabled_map|get_item:quote.id %}
                <a href="/chat/{{ quote.id }}" class="text-green-600 hover:underline text-sm block mt-2">
                  💬 Start Negotiation
                </a>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
        <a href="/quotes/my" class="text-sm text-green-600 hover:underline mt-2 inline-block">View All Quotes →</a>
      {% else %}
        <p class="text-gray-600">You haven’t placed any quotes yet.</p>
      {% endif %}
    </div>

    <p class="text-sm text-gray-500 mt-8">Need help? <a href="#" class="text-blue-500 hover:underline">Contact Support</a></p>
  </div>
</main>
{% endblock %}