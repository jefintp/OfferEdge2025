{% extends 'base_logged_in.html' %}
{% block title %}Moderation Panel | OfferEdge{% endblock %}
{% block content %}
<main class="p-6 bg-gray-50 min-h-screen">
  <h1 class="text-3xl font-bold text-gray-800 mb-6">üõ°Ô∏è Moderation Panel</h1>

  <!-- üîπ Users Table -->
  <section class="mb-10">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">All Users</h2>
    <table class="w-full bg-white shadow rounded">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">UserID</th>
          <th class="p-2 text-left">Buyer</th>
          <th class="p-2 text-left">Seller</th>
          <th class="p-2 text-left">Admin</th>
          <th class="p-2 text-left">Banned</th>
          <th class="p-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr class="border-t">
          <td class="p-2">{{ user.userid }}</td>
          <td class="p-2">{% if user.is_buyer %}‚úÖ{% else %}‚Äî{% endif %}</td>
          <td class="p-2">{% if user.is_seller %}‚úÖ{% else %}‚Äî{% endif %}</td>
          <td class="p-2">{% if user.is_admin %}üõ°Ô∏è{% else %}‚Äî{% endif %}</td>
          <td class="p-2 text-red-600 font-bold">{% if user.is_banned %}üö´{% else %}‚Äî{% endif %}</td>
          <td class="p-2 space-y-1">
            {% if user.is_banned %}
            <form method="POST" action="/moderator/unban_user/{{ user.id }}">
              {% csrf_token %}
              <button class="text-green-600 hover:underline text-sm">Unban</button>
            </form>
            {% else %}
            <form method="POST" action="/moderator/ban_user/{{ user.id }}">
              {% csrf_token %}
              <button class="text-red-600 hover:underline text-sm">Ban</button>
            </form>
            {% endif %}
            <form method="POST" action="/moderator/delete_user/{{ user.id }}">
              {% csrf_token %}
              <button class="text-gray-600 hover:underline text-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <!-- üîπ Requirements Table -->
  <section class="mb-10">
    <h2 class="text-xl font-semibold text-gray-700 mb-4">All Requirements</h2>
    <ul class="space-y-4">
      {% for req in requirements %}
      <li class="bg-white p-4 rounded shadow">
        <h3 class="text-lg font-bold text-blue-600">{{ req.title }}</h3>
        <p class="text-sm text-gray-700">{{ req.description }}</p>
        <p class="text-xs text-gray-500">Posted by: {{ req.buyerid }} | {{ req.createdAt }}</p>
        <form action="/requirements/delete/{{ req.id }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this requirement?');" class="mt-2">
          {% csrf_token %}
          <button type="submit" class="text-red-600 font-semibold hover:underline">üóëÔ∏è Delete</button>
        </form>
      </li>
      {% endfor %}
    </ul>
  </section>

  <!-- üîπ Placed Quotes Table -->
  <section>
    <h2 class="text-xl font-semibold text-gray-700 mb-4">Placed Quotes</h2>
    <table class="w-full bg-white shadow rounded">
      <thead class="bg-gray-100">
        <tr>
          <th class="p-2 text-left">QuoteID</th>
          <th class="p-2 text-left">ReqID</th>
          <th class="p-2 text-left">Seller</th>
          <th class="p-2 text-left">Price</th>
          <th class="p-2 text-left">Finalized</th>
          <th class="p-2 text-left">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for quote in quotes %}
        <tr class="border-t">
          <td class="p-2">{{ quote.id }}</td>
          <td class="p-2">{{ quote.req_id }}</td>
          <td class="p-2">{{ quote.seller_id }}</td>
          <td class="p-2">‚Çπ{{ quote.price }}</td>
          <td class="p-2">{% if quote.finalized %}‚úÖ{% else %}‚Äî{% endif %}</td>
          <td class="p-2 space-x-2">
            {% if not quote.finalized %}
            <form method="POST" action="/moderator/finalize_quote/{{ quote.id }}" class="inline">
              {% csrf_token %}
              <button class="text-green-600 hover:underline text-sm">Finalize</button>
            </form>
            {% endif %}
            <form method="POST" action="/moderator/delete_quote/{{ quote.id }}" class="inline">
              {% csrf_token %}
              <button class="text-red-600 hover:underline text-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</main>
{% endblock %}